---
title: "notion과 연계하여 slack bot 만들기"
date: 2021-01-07T21:57:59+09:00
draft: true
categories:
    - Experience
---

<br/>

3개월전쯤 사이드 프로젝트를 진행하며 슬랙봇을 간단히 개발할 일이 있었다.         
포스팅하기에 늦은감이 약간 있지만 의미있었던 경험이라 더 늦기전에 기록으로 남겨둔다.

<br/>

## Problem

팀원들과 사이드 프로젝트 진행환경을 함께 세팅해 나가면서 가장 신경썼던 부분은 **지속성**이였다.

우선 사이드 프로젝트를 진행하는데 사용한 협업 도구는 다음과 같다.
- **notion** : 회의록 정리, 산출물 문서화, 할당 작업별 진행 기록 작성을 위해 사용
- **slack** : 업무 메시지와 개인 메시지 분리를 위해 사용
- **github** : 코드 버전 관리


팀원들 모두가 학생이 아니다보니 개인별로 우선되는 일들이 있어 사이드 프로젝트의 선후 작업들에 대해 데드라인을 특정할 수 없었다. 즉, 워터폴을 사용하기에는 무리가 있었다. 워터폴대신 애자일을 

모두가 사이드 프로젝트에 완전히 포커싱하는 것이 어렵다보니 

하지만 

어떻게 하면 팀원들과 커뮤니케이션의 인터럽트를 최소화할 수 있을까에 대해 고민하다가 자기가 맡은 작업에 대해 진행 사항이 있을 경우 진행이 어떻게 되고 있는지를 다른 팀원들에게 알려주기 위해 작업기록을 작성할 수 있는 페이지를 생성하였다.

{{<image src="/images/2021-01-07-slackbot/slackbot-process-1.png" width="100%" caption="작업기록 조회 및 등록을 위한 노션 페이지">}}

작업기록이 등록되는 시점은 비정기적이기에 작업기록이 등록되면 알림을 줄 수 있는 기능이 필요했다. 노션 모바일 앱을 통해 푸시 알림을 받을수도 있으나 커뮤니케이션 도구를 최대한 단순히 가져가기 위해 도큐먼테이션을 제외하고 모든 활동들이 슬랙에서 집중되길 원했다.

<br/>

{{<image src="/images/2021-01-07-slackbot/slackbot-process-2.png" width="90%" caption="noti-notion 채널에 기록되는 변경사항 히스토리">}}

슬랙 채널에 노션앱을 추가하여 변경사항들에 대한 기록을 확인하는 것이 가능하다. 하지만 아래 두가지 이유로 노션 로그를 기록하는 채널을 그대로 사용하기에는 무리가 있어 보였다.
1. 변경사항들에 대한 로그가 가독성이 떨어진다.
1. 변경사항들에 대해 리뷰를 남기기가 불편하다. 
    - 리뷰를 남기기 위해서는 1)로그를 기록하는 채널에서 스레드를 생성하거나, 2)다른 채널에서 작업자에게 멘션을 하거나, 3)기록이 등록된 노션 페이지에서 직접 코멘트를 남길수 있다.
    - 로그를 기록하는 채널에서 스레드를 생성하는 방식은 추후 과거의 논의 사항을 조회하기가 힘들다.
    - 다른 채널에서 작업자에게 멘션하는 방식은 
    - 기록이 등록된 노션 페이지에서 직접 코멘트를 남기는 방식은 대화가 슬랙과 노션 모두에서 이루어지기에 분산된다.

<br/>

1. 작업기록에 대한 리뷰를 슬랙에서 쉽게 남길수 있어야 한다.
1. 변경사항들에 대해 알림을 받을 수 있어야한다.

<br/>

## Solving


`noti-notion` 채널에 들어온 메시지를 추출해보니 아래와 같은 json 포맷의 데이터를 얻을 수 있었다. 
```json
{
  "type": "message",
  "subtype": "bot_message",
  "text": "교준 안 edited *<https://www.notion.so/altera520/test-fee1f83e240e4bf39c3e915ac827cbfb?n=activity_block_edited&amp;n=slack%7C:zap: test>*",
  "ts": "1600808517.004900",
  "bot_id": "B01AVLEN8NA",
  "attachments": [
    {
      "text": "*상태*: Empty → 작성완료",
      "id": 1,
      "color": "F0EFEF",
      "fallback": "*상태*: Empty → 작성완료"
    },
    {
      "text": "*Name*: Empty → test",
      "id": 2,
      "color": "F0EFEF",
      "fallback": "*Name*: Empty → test"
    },
    {
      "footer": "교준 안",
      "id": 3,
      "footer_icon": "https://s3-us-west-2.amazonaws.com/public.notion-static.com/cabbee10-5410-46c9-9bb2-456b5761e756/DSC06789-10.jpg",
      "ts": 1600808516,
      "color": "F0EFEF",
      "fallback": "[no preview available]"
    }
  ],
  "channel": "C01AY6YSPCM",
  "event_ts": "1600808517.004900",
  "channel_type": "channel"
}
```

<br/>

{{<image src="/images/2021-01-07-slackbot/slackbot-5.png" width="90%" caption="팀원의 개인정보를 위해 닉네임은 모자이크 처리하였다.">}}

최종적으로 위와 같은 결과를 얻을 수 있었다.         
슬랙봇의 해당 기능은 유용하게 사용하고 있으며, 무엇보다도 팀원들에게 조금이나마 도움이될 수 있었다는 점에서 기쁘다.             

현재는 notion에서 API 베타 테스트를 진행중인 것으로 알고있다. 올해 1~2분기쯤에 릴리즈될 것으로 보이는데      
어떤 API 리스트를 제공해줄지는 발표나지 않았으나, notion으로 작성한 포스트 업데이트 정보를 받아올 수 있는 API가 포함된다면 해당 게시물은 deprecated 될 듯하다.

<br/>

## References